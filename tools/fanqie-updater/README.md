# 番茄小说更新工具

一个用于管理小说章节并辅助更新到番茄小说平台的命令行工具。

## 功能特点

- 📊 **更新报告**：查看小说更新状态和待更新章节信息
- 📤 **章节导出**：将Markdown章节转换为番茄小说编辑器格式
- ✅ **状态管理**：标记章节为已发布或未发布
- 📋 **章节管理**：查看章节列表和详细信息
- 📝 **更新日志**：记录章节更新历史
- ⚙️ **配置管理**：灵活配置小说信息和路径

## 技术栈

- Node.js
- Markdown-it（Markdown解析）
- Inquirer.js（交互式命令行）
- Chalk（命令行样式）

## 安装步骤

1. 确保已安装Node.js（推荐v14及以上版本）
2. 进入工具目录
   ```bash
   cd tools/fanqie-updater
   ```
3. 安装依赖
   ```bash
   npm install
   ```

## 使用方法

### 启动工具

```bash
node index.js
```

### 主菜单功能

#### 1. 查看更新报告
显示小说的更新状态，包括：
- 总章节数和已发布章节数
- 待更新章节列表和字数统计
- 最近更新时间

#### 2. 导出待更新章节
将所有未发布章节导出为三种格式：
- **JSON文件**：包含完整章节信息和元数据
- **纯文本文件**：适合直接复制到番茄小说编辑器
- **HTML预览文件**：用于本地预览章节效果

#### 3. 导出指定章节
选择特定章节进行导出，支持多选。

#### 4. 标记章节为已发布
将选中的未发布章节标记为已发布状态，并记录到更新日志。

#### 5. 标记章节为未发布
将选中的已发布章节标记为未发布状态。

#### 6. 查看章节列表
显示所有章节的详细信息，包括：
- 章节ID和标题
- 发布状态
- 字数统计

#### 7. 查看更新日志
显示章节的更新历史记录。

#### 8. 修改配置
修改小说基本信息和路径配置：
- 小说名称
- 作者名称
- 章节目录路径

#### 9. 退出
退出工具。

## 项目结构

```
fanqie-updater/
├── config.js              # 配置管理模块
├── index.js              # 主程序入口
├── package.json          # 项目依赖
├── README.md             # 使用说明
├── utils/
│   ├── chapter.js        # 章节管理模块
│   ├── format.js         # 格式转换模块
│   └── update.js         # 更新管理模块
└── exports/              # 导出文件目录
    └── update-log.json   # 更新日志
```

## 配置说明

配置文件位于项目根目录，可通过菜单中的「修改配置」功能进行调整，或直接编辑`config.js`文件。

### 配置项

```json
{
  "novel": {
    "name": "九龙修真记",        # 小说名称
    "author": "九王爷"           # 作者名称
  },
  "directories": {
    "chapterPath": "../../md/章节/正传",  # 章节目录路径
    "updateLogPath": "update-log.json",  # 更新日志路径
    "exportPath": "exports"              # 导出文件路径
  },
  "fanqie": {
    "platform": "番茄小说",     # 平台名称
    "autoSave": false              # 是否自动保存
  }
}
```

## 章节目录结构

工具会自动扫描配置中指定的章节目录，读取所有`.md`文件作为章节。

### 章节文件格式

章节文件应使用Markdown格式，第一行为章节标题，格式为：

```markdown
# 第1章 九命初醒

章节内容...
```

### 章节排序

章节文件会按照文件名中的数字顺序排序，建议使用如下命名格式：

```
第1章.md
第2章.md
...
第10章.md
```

## 导出文件说明

### JSON格式

包含完整的章节信息，适合进一步处理：

```json
{
  "novelName": "九龙修真记",
  "author": "九王爷",
  "exportTime": "2023-12-26T10:00:00.000Z",
  "chapters": [
    {
      "id": 1,
      "title": "第1章 九命初醒",
      "wordCount": 2000,
      "content": "转换后的章节内容...",
      "rawContent": "原始Markdown内容..."
    }
  ]
}
```

### 纯文本格式

适合直接复制到番茄小说编辑器，格式清晰：

```

第1章 九命初醒

章节内容...

--- 章节结束 ---


第2章 兄弟情谊

章节内容...

--- 章节结束 ---
```

### HTML预览格式

用于本地预览章节效果，包含样式和元数据。

## 更新日志

更新日志记录了章节的发布历史，位于`update-log.json`文件中：

```json
{
  "publishedChapters": ["第1章.md", "第2章.md"],
  "updateHistory": [
    {
      "chapterId": 1,
      "chapterTitle": "第1章 九命初醒",
      "filename": "第1章.md",
      "publishTime": "2023-12-26T10:00:00.000Z",
      "wordCount": 2000
    }
  ]
}
```

## 注意事项

1. 番茄小说平台目前没有公开API，此工具仅提供章节管理和格式转换功能
2. 导出的纯文本文件可直接复制到番茄小说作家后台编辑器
3. 建议定期备份更新日志和配置文件
4. 章节目录路径支持相对路径和绝对路径

## 常见问题

### Q: 为什么找不到章节文件？
A: 请检查配置中的章节目录路径是否正确，确保目录下有`.md`格式的章节文件。

### Q: 导出的文件在哪里？
A: 导出文件默认存放在`exports`目录下，可通过配置修改导出路径。

### Q: 如何修改小说名称和作者？
A: 在主菜单中选择「修改配置」选项进行修改。

## 版本更新

### v1.0.0
- 初始版本发布
- 实现章节管理和导出功能
- 支持更新状态跟踪
- 提供交互式命令行界面

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个工具！